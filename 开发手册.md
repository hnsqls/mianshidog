# é¡¹ç›®ä»‹ç»

 é¢è¯•ç‹—ï¼Œå¸®åŠ©æ±‚èŒè€…æ›´åŠ æœ‰æ•ˆçš„å¯»æ‰¾é¢è¯•é¢˜ã€‚

# é¡¹ç›®èƒŒæ™¯

é¢è¯•é¢˜æ•´ç†èµ·æ¥æœç´¢ä¸æ–¹ä¾¿ã€‚

# æ ¸å¿ƒä¸šåŠ¡æµç¨‹

![image-20240827092722792](images/å¼€å‘æ‰‹å†Œ.assets/image-20240827092722792.png)



# é¡¹ç›®åŠŸèƒ½æ¢³ç†

**åŸºç¡€åŠŸèƒ½P0**

* ç”¨æˆ·æ¨¡å—
  * ç”¨æˆ·æ³¨å†Œ
  * ç™»å½•
  * [ç®¡ç†å‘˜]ç®¡ç†ç”¨æˆ·-å¢åˆ æ”¹æŸ¥ã€‚
* é¢˜åº“æ¨¡å—
  * æŸ¥çœ‹é¢˜åº“åˆ—è¡¨
  * æŸ¥çœ‹é¢˜åº“è¯¦æƒ…ï¼ˆé¢˜åº“ä¸‹çš„é¢˜ç›®ï¼‰
  * [ç®¡ç†å‘˜]ç®¡ç†é¢˜åº“-å¢åˆ æ”¹æŸ¥ã€‚
* é¢˜ç›®æ¨¡å—
  * é¢˜ç›®æœç´¢
  * æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…
  * ã€ç®¡ç†å‘˜ã€‘ç®¡ç†é¢˜ç›®

**é«˜çº§åŠŸèƒ½P1~P2**

* é¢˜ç›®æ‰¹é‡ç®¡ç† P1
  * ã€ç®¡ç†å‘˜ã€‘æ‰¹é‡å‘é¢˜ç›®æ·»åŠ é¢˜ç›®
  * ã€ç®¡ç†å‘˜ã€‘æ‰¹é‡ä»é¢˜åº“ç§»é™¤é¢˜ç›®
  * ã€ç®¡ç†å‘˜ã€‘æ‰¹é‡åˆ é™¤é¢˜ç›®
* åˆ†è¯é¢˜ç›®æœç´¢ P1
* ç”¨æˆ·åˆ·é¢˜è®°å½•æ—¥å†å›¾P1
* è‡ªåŠ¨ç¼“å­˜çƒ­é—¨é¢˜ç›®P2
* é€šæ–­ç™»å½•å†²çªæ£€æµ‹P2







# ç¯å¢ƒå‡†å¤‡

jdk17

mysql 8

# åº“è¡¨è®¾è®¡

```sql
-- åˆ›å»ºåº“
create database if not exists mianshidog;

-- åˆ‡æ¢åº“
use mianshidog;

-- ç”¨æˆ·è¡¨
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment 'è´¦å·',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    unionId      varchar(256)                           null comment 'å¾®ä¿¡å¼€æ”¾å¹³å°id',
    mpOpenId     varchar(256)                           null comment 'å…¬ä¼—å·openId',
    userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    userProfile  varchar(512)                           null comment 'ç”¨æˆ·ç®€ä»‹',
    userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban',
    editTime     datetime     default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_unionId (unionId)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;

-- é¢˜åº“è¡¨
create table if not exists question_bank
(
    id          bigint auto_increment comment 'id' primary key,
    title       varchar(256)                       null comment 'æ ‡é¢˜',
    description text                               null comment 'æè¿°',
    picture     varchar(2048)                      null comment 'å›¾ç‰‡',
    userId      bigint                             not null comment 'åˆ›å»ºç”¨æˆ· id',
    editTime    datetime default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    createTime  datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete    tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_title (title)
) comment 'é¢˜åº“' collate = utf8mb4_unicode_ci;

-- é¢˜ç›®è¡¨
create table if not exists question
(
    id         bigint auto_increment comment 'id' primary key,
    title      varchar(256)                       null comment 'æ ‡é¢˜',
    content    text                               null comment 'å†…å®¹',
    tags       varchar(1024)                      null comment 'æ ‡ç­¾åˆ—è¡¨ï¼ˆjson æ•°ç»„ï¼‰',
    answer     text                               null comment 'æ¨èç­”æ¡ˆ',
    userId     bigint                             not null comment 'åˆ›å»ºç”¨æˆ· id',
    editTime   datetime default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    createTime datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_title (title),
    index idx_userId (userId)
) comment 'é¢˜ç›®' collate = utf8mb4_unicode_ci;

-- é¢˜åº“é¢˜ç›®è¡¨ï¼ˆç¡¬åˆ é™¤ï¼‰
create table if not exists question_bank_question
(
    id             bigint auto_increment comment 'id' primary key,
    questionBankId bigint                             not null comment 'é¢˜åº“ id',
    questionId     bigint                             not null comment 'é¢˜ç›® id',
    userId         bigint                             not null comment 'åˆ›å»ºç”¨æˆ· id',
    createTime     datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime     datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    UNIQUE (questionBankId, questionId)
) comment 'é¢˜åº“é¢˜ç›®' collate = utf8mb4_unicode_ci;
```



# å‡†å¤‡å·¥ä½œ

mybaits-xç”Ÿæˆç›¸å…³ä»£ç ã€‚

ä½¿ç”¨æˆ‘ä»¬å†™å¥½çš„ä»£ç ç”Ÿæˆå™¨ï¼Œç”Ÿæˆcrudä»£ç 

æ•°æ®æ¨¡å‹å¼€å‘dtoå’Œvo

# debug



## æ•°æ®å‡†å¤‡

```sql
-- åˆå§‹æ•°æ®
use mianshidog;

-- ç”¨æˆ·è¡¨åˆå§‹æ•°æ®ï¼ˆå¯†ç æ˜¯ 12345678ï¼‰
INSERT INTO user (id, userAccount, userPassword, unionId, mpOpenId, userName, userAvatar, userProfile, userRole)
VALUES (1, 'user1', 'b0dd3697a192885d7c055db46155b26a', 'unionId1', 'mpOpenId1', 'user1',
        'https://www.code-nav.cn/logo.png', 'å–œæ¬¢ç¼–ç¨‹çš„å°ç™½', 'user'),
       (2, 'user2', 'b0dd3697a192885d7c055db46155b26a', 'unionId2', 'mpOpenId2', 'user2',
        'https://www.code-nav.cn/logo.png', 'å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ', 'user'),
       (3, 'user3', 'b0dd3697a192885d7c055db46155b26a', 'unionId3', 'mpOpenId3', 'user3',
        'https://www.code-nav.cn/logo.png', 'å‰ç«¯çˆ±å¥½è€…', 'user'),
       (4, 'user4', 'b0dd3697a192885d7c055db46155b26a', 'unionId4', 'mpOpenId4', 'user4',
        'https://www.code-nav.cn/logo.png', 'åç«¯å¼€å‘å·¥ç¨‹å¸ˆ', 'user'),
       (5, 'æç¡•', 'b0dd3697a192885d7c055db46155b26a', NULL, NULL, 'hnsqls', 'https://www.code-nav.cn/logo.png',
        'ç³»ç»Ÿç®¡ç†å‘˜', 'admin');

-- é¢˜åº“è¡¨åˆå§‹æ•°æ®
INSERT INTO question_bank (title, description, picture, userId)
VALUES ('JavaScript åŸºç¡€', 'åŒ…å« JavaScript çš„åŸºç¡€çŸ¥è¯†é¢˜ç›®',
        'https://pic.code-nav.cn/mianshiya/question_bank_picture/1777886594896760834/JldkWf9w_JavaScript.png', 1),
       ('CSS æ ·å¼', 'åŒ…å« CSS ç›¸å…³çš„æ ·å¼é—®é¢˜',
        'https://pic.code-nav.cn/mianshiya/question_bank_picture/1777886594896760834/QatnFmEN_CSS.png', 2),
       ('HTML åŸºç¡€', 'HTML æ ‡è®°è¯­è¨€çš„åŸºæœ¬çŸ¥è¯†', 'https://www.mianshiya.com/logo.png', 3),
       ('å‰ç«¯æ¡†æ¶', 'React, Vue, Angular ç­‰æ¡†æ¶ç›¸å…³çš„é¢˜ç›®', 'https://www.mianshiya.com/logo.png', 1),
       ('ç®—æ³•ä¸æ•°æ®ç»“æ„', 'æ•°æ®ç»“æ„å’Œç®—æ³•é¢˜ç›®', 'https://www.mianshiya.com/logo.png', 2),
       ('æ•°æ®åº“åŸç†', 'SQL è¯­å¥å’Œæ•°æ®åº“è®¾è®¡', 'https://www.mianshiya.com/logo.png', 3),
       ('æ“ä½œç³»ç»Ÿ', 'æ“ä½œç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µ', 'https://www.mianshiya.com/logo.png', 1),
       ('ç½‘ç»œåè®®', 'HTTP, TCP/IP ç­‰ç½‘ç»œåè®®é¢˜ç›®', 'https://www.mianshiya.com/logo.png', 2),
       ('è®¾è®¡æ¨¡å¼', 'å¸¸è§è®¾è®¡æ¨¡å¼åŠå…¶åº”ç”¨', 'https://www.mianshiya.com/logo.png', 3),
       ('ç¼–ç¨‹è¯­è¨€æ¦‚è¿°', 'å¤šç§ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€çŸ¥è¯†', 'https://www.mianshiya.com/logo.png', 1),
       ('ç‰ˆæœ¬æ§åˆ¶', 'Git å’Œ SVN çš„ä½¿ç”¨', 'https://www.mianshiya.com/logo.png', 2),
       ('å®‰å…¨ä¸åŠ å¯†', 'ç½‘ç»œå®‰å…¨å’ŒåŠ å¯†æŠ€æœ¯', 'https://www.mianshiya.com/logo.png', 3),
       ('äº‘è®¡ç®—', 'äº‘æœåŠ¡å’Œæ¶æ„', 'https://www.mianshiya.com/logo.png', 1),
       ('å¾®æœåŠ¡æ¶æ„', 'å¾®æœåŠ¡çš„è®¾è®¡ä¸å®ç°', 'https://www.mianshiya.com/logo.png', 2),
       ('å®¹å™¨æŠ€æœ¯', 'Docker å’Œ Kubernetes ç›¸å…³çŸ¥è¯†', 'https://www.mianshiya.com/logo.png', 3),
       ('DevOps å®è·µ', 'æŒç»­é›†æˆä¸æŒç»­äº¤ä»˜', 'https://www.mianshiya.com/logo.png', 1),
       ('æ•°æ®åˆ†æ', 'æ•°æ®åˆ†æå’Œå¯è§†åŒ–', 'https://www.mianshiya.com/logo.png', 2),
       ('äººå·¥æ™ºèƒ½', 'æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ åŸºç¡€', 'https://www.mianshiya.com/logo.png', 3),
       ('åŒºå—é“¾æŠ€æœ¯', 'åŒºå—é“¾çš„åŸºæœ¬åŸç†å’Œåº”ç”¨', 'https://www.mianshiya.com/logo.png', 1),
       ('é¡¹ç›®ç®¡ç†', 'è½¯ä»¶å¼€å‘é¡¹ç›®çš„ç®¡ç†å’Œæ‰§è¡Œ', 'https://www.mianshiya.com/logo.png', 2);

-- é¢˜ç›®è¡¨åˆå§‹æ•°æ®
INSERT INTO question (title, content, tags, answer, userId)
VALUES ('JavaScript å˜é‡æå‡', 'è¯·è§£é‡Š JavaScript ä¸­çš„å˜é‡æå‡ç°è±¡ã€‚', '["JavaScript", "åŸºç¡€"]',
        'å˜é‡æå‡æ˜¯æŒ‡åœ¨ JavaScript ä¸­ï¼Œå˜é‡å£°æ˜ä¼šè¢«æå‡åˆ°ä½œç”¨åŸŸçš„é¡¶éƒ¨ã€‚', 1),
       ('CSS Flexbox å¸ƒå±€', 'å¦‚ä½•ä½¿ç”¨ CSS å®ç°ä¸€ä¸ªæ°´å¹³å±…ä¸­çš„ç›’å­ï¼Ÿ', '["CSS", "å¸ƒå±€"]',
        'å¯ä»¥ä½¿ç”¨ Flexbox å¸ƒå±€ï¼Œé€šè¿‡è®¾ç½®çˆ¶å®¹å™¨ display ä¸º flexï¼Œå¹¶ä½¿ç”¨ justify-content: center; å¯¹é½å­å…ƒç´ ã€‚', 2),
       ('HTML ä¸­çš„è¯­ä¹‰åŒ–', 'ä»€ä¹ˆæ˜¯ HTML çš„è¯­ä¹‰åŒ–ï¼Ÿä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ', '["HTML", "è¯­ä¹‰åŒ–"]',
        'HTML è¯­ä¹‰åŒ–æ˜¯ä½¿ç”¨æ­£ç¡®çš„æ ‡ç­¾æ¥æè¿°å†…å®¹çš„æ„ä¹‰ï¼Œèƒ½å¤Ÿæé«˜å¯è®¿é—®æ€§å’Œ SEO æ•ˆæœã€‚', 3),
       ('React ä¸­çš„çŠ¶æ€ç®¡ç†', 'å¦‚ä½•åœ¨ React ä¸­ç®¡ç†ç»„ä»¶çŠ¶æ€ï¼Ÿ', '["React", "çŠ¶æ€ç®¡ç†"]',
        'å¯ä»¥ä½¿ç”¨ React çš„ useState æˆ– useReducer é’©å­æ¥ç®¡ç†ç»„ä»¶çŠ¶æ€ï¼Œæˆ–ä½¿ç”¨ Redux è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†ã€‚', 1),
       ('ç®—æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾', 'è¯·å®ç°ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾ç®—æ³•ã€‚', '["ç®—æ³•", "æ•°æ®ç»“æ„"]',
        'äºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€ç§åœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ç‰¹å®šå…ƒç´ çš„ç®—æ³•ï¼Œé€šè¿‡ä¸æ–­æŠ˜åŠçš„æ–¹å¼ç¼©å°æŸ¥æ‰¾èŒƒå›´ã€‚', 2),
       ('æ•°æ®åº“ç´¢å¼•çš„ä½œç”¨', 'ä»€ä¹ˆæ˜¯æ•°æ®åº“ç´¢å¼•ï¼Ÿå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ', '["æ•°æ®åº“", "ç´¢å¼•"]',
        'æ•°æ®åº“ç´¢å¼•æ˜¯ç”¨äºåŠ å¿«æŸ¥è¯¢é€Ÿåº¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒé€šè¿‡ä¼˜åŒ–æŸ¥æ‰¾è·¯å¾„å‡å°‘æŸ¥è¯¢æ—¶é—´ã€‚', 3),
       ('HTTP ä¸ HTTPS çš„åŒºåˆ«', 'è¯·è§£é‡Š HTTP å’Œ HTTPS ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ã€‚', '["ç½‘ç»œ", "åè®®"]',
        'HTTPS æ˜¯åŠ å¯†çš„ HTTPï¼Œé€šè¿‡ SSL/TLS æä¾›æ›´å®‰å…¨çš„æ•°æ®ä¼ è¾“ã€‚', 1),
       ('è®¾è®¡æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼', 'è¯·è§£é‡Šå•ä¾‹æ¨¡å¼çš„å®ç°åŠåº”ç”¨åœºæ™¯ã€‚', '["è®¾è®¡æ¨¡å¼", "å•ä¾‹"]',
        'å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚å¸¸ç”¨äºé…ç½®ç±»ç­‰åªéœ€ä¸€ä¸ªå®ä¾‹çš„åœºæ™¯ã€‚', 2),
       ('Git ä¸­çš„åˆ†æ”¯ç®¡ç†', 'å¦‚ä½•åœ¨ Git ä¸­ç®¡ç†åˆ†æ”¯ï¼Ÿ', '["ç‰ˆæœ¬æ§åˆ¶", "Git"]',
        'Git ä¸­é€šè¿‡ branch å‘½ä»¤åˆ›å»ºåˆ†æ”¯ï¼Œä½¿ç”¨ checkout åˆ‡æ¢åˆ†æ”¯ï¼Œä½¿ç”¨ merge åˆå¹¶åˆ†æ”¯ã€‚', 3),
       ('Docker çš„åŸºæœ¬å‘½ä»¤', 'åˆ—ä¸¾å¹¶è§£é‡Šå‡ ä¸ªå¸¸ç”¨çš„ Docker å‘½ä»¤ã€‚', '["å®¹å™¨æŠ€æœ¯", "Docker"]',
        'å¸¸ç”¨å‘½ä»¤åŒ…æ‹¬ docker run, docker build, docker ps, docker stop ç­‰ã€‚', 1),
       ('å‰ç«¯æ€§èƒ½ä¼˜åŒ–', 'åˆ—ä¸¾å‡ ä¸ªå‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µã€‚', '["å‰ç«¯", "æ€§èƒ½ä¼˜åŒ–"]',
        'åŒ…æ‹¬ä»£ç åˆ†å‰²ã€èµ„æºå‹ç¼©ã€ç¼“å­˜ç­–ç•¥ã€æ‡’åŠ è½½ç­‰ã€‚', 2),
       ('JavaScript é—­åŒ…çš„åº”ç”¨', 'ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿä¸¾ä¾‹è¯´æ˜é—­åŒ…çš„å®é™…åº”ç”¨ã€‚', '["JavaScript", "é«˜çº§"]',
        'é—­åŒ…æ˜¯æŒ‡å‡½æ•°èƒ½å¤Ÿè®°ä½åˆ›å»ºæ—¶çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¸¸ç”¨äºæ•°æ®éšè—å’Œæ¨¡å—åŒ–ç¼–ç¨‹ã€‚', 3),
       ('æ•°æ®åº“äº‹åŠ¡çš„ç‰¹æ€§', 'è¯·è§£é‡Šæ•°æ®åº“äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚', '["æ•°æ®åº“", "äº‹åŠ¡"]',
        'ACID ä»£è¡¨åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼Œæ˜¯äº‹åŠ¡å¤„ç†çš„å››å¤§ç‰¹æ€§ã€‚', 1),
       ('CSS çš„ BEM å‘½åè§„èŒƒ', 'ä»€ä¹ˆæ˜¯ BEMï¼Ÿå¦‚ä½•ä½¿ç”¨ BEM è¿›è¡Œ CSS å‘½åï¼Ÿ', '["CSS", "å‘½åè§„èŒƒ"]',
        'BEM ä»£è¡¨å—ï¼ˆBlockï¼‰ã€å…ƒç´ ï¼ˆElementï¼‰å’Œä¿®é¥°ç¬¦ï¼ˆModifierï¼‰ï¼Œæ˜¯ä¸€ç§ CSS å‘½åè§„èŒƒã€‚', 2),
       ('JavaScript åŸå‹é“¾', 'è¯·è§£é‡Š JavaScript ä¸­çš„åŸå‹é“¾æœºåˆ¶ã€‚', '["JavaScript", "åŸå‹é“¾"]',
        'åŸå‹é“¾æ˜¯ JavaScript å®ç°ç»§æ‰¿çš„æœºåˆ¶ï¼Œå¯¹è±¡é€šè¿‡åŸå‹é“¾å¯ä»¥ç»§æ‰¿å…¶ä»–å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚', 3),
       ('React ç”Ÿå‘½å‘¨æœŸ', 'è¯·è¯´æ˜ React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚', '["React", "ç”Ÿå‘½å‘¨æœŸ"]',
        'React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬åˆå§‹åŒ–ã€æ›´æ–°å’Œå¸è½½ä¸‰ä¸ªé˜¶æ®µï¼Œå„é˜¶æ®µæœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚', 1),
       ('HTTP çŠ¶æ€ç  404 ä¸ 500 çš„åŒºåˆ«', 'è¯·è§£é‡Š HTTP çŠ¶æ€ç  404 å’Œ 500 çš„å«ä¹‰ã€‚', '["ç½‘ç»œ", "HTTP"]',
        '404 è¡¨ç¤ºæœªæ‰¾åˆ°èµ„æºï¼Œ500 è¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚', 2),
       ('Python ä¸ Java çš„åŒºåˆ«', 'æ¯”è¾ƒ Python å’Œ Java çš„ä¸»è¦åŒºåˆ«ã€‚', '["ç¼–ç¨‹è¯­è¨€", "Python", "Java"]',
        'Python æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œè¯­æ³•ç®€æ´ï¼Œè€Œ Java æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ³¨é‡ä¸¥è°¨æ€§å’Œæ€§èƒ½ã€‚', 3),
       ('Vue çš„åŒå‘æ•°æ®ç»‘å®š', 'è¯·è§£é‡Š Vue.js æ˜¯å¦‚ä½•å®ç°åŒå‘æ•°æ®ç»‘å®šçš„ã€‚', '["Vue", "æ•°æ®ç»‘å®š"]',
        'Vue.js é€šè¿‡æ•°æ®åŠ«æŒå’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼å®ç°äº†åŒå‘æ•°æ®ç»‘å®šã€‚', 1),
       ('å‰ç«¯å·¥ç¨‹åŒ–çš„æ„ä¹‰', 'ä¸ºä»€ä¹ˆéœ€è¦å‰ç«¯å·¥ç¨‹åŒ–ï¼Ÿ', '["å‰ç«¯", "å·¥ç¨‹åŒ–"]',
        'å‰ç«¯å·¥ç¨‹åŒ–èƒ½å¤Ÿæé«˜å¼€å‘æ•ˆç‡ã€ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ï¼Œè§„èŒƒå¼€å‘æµç¨‹ã€‚', 2);

-- é¢˜åº“é¢˜ç›®å…³è”åˆå§‹æ•°æ®
INSERT INTO question_bank_question (questionBankId, questionId, userId)
VALUES (1, 1, 1),
       (1, 2, 1),
       (1, 3, 1),
       (1, 4, 1),
       (1, 5, 1),
       (1, 6, 1),
       (1, 7, 1),
       (1, 8, 1),
       (1, 9, 1),
       (1, 10, 1),
       (2, 2, 2),
       (2, 14, 2),
       (3, 3, 3),
       (3, 13, 3),
       (4, 4, 1),
       (4, 16, 1),
       (5, 5, 2),
       (5, 18, 2),
       (6, 6, 3),
       (6, 19, 3),
       (7, 7, 1),
       (7, 11, 1),
       (8, 8, 2),
       (8, 10, 2),
       (9, 9, 3),
       (9, 17, 3),
       (10, 12, 1),
       (10, 20, 1);

```

# æ‰©å±•åŠŸèƒ½

## 1.ç”¨æˆ·ç­¾åˆ°è®°å½•

### 1.1 éœ€æ±‚åˆ†æ

ä¸ºäº†é¼“åŠ±ç”¨æˆ·å¤šåˆ·é¢˜ï¼Œå¼€å‘ç­¾åˆ°è®°å½•ï¼Œå¹¶ä»¥æ—¥å†å›¾çš„æ–¹å¼æ˜¾ç¤ºã€‚

### 1.2 æ–¹æ¡ˆè®¾è®¡

**1.2.1 æ–¹æ¡ˆä¸€ æ•°æ®åº“**

æ•°æ®åº“å­˜ç­¾åˆ°ä¿¡æ¯ï¼Œé€šè¿‡å”¯ä¸€ç´¢å¼•ç¡®ä¿ä¸€å¤©ç­¾åˆ°ä¸€æ¬¡

```sql
CREATE TABLE user_sign_in (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,  -- ä¸»é”®ï¼Œè‡ªåŠ¨é€’å¢
  userId BIGINT NOT NULL,               -- ç”¨æˆ·IDï¼Œå…³è”ç”¨æˆ·è¡¨
  signDate DATE NOT NULL,            -- ç­¾åˆ°æ—¥æœŸ
  createdTime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- è®°å½•åˆ›å»ºæ—¶é—´
  UNIQUE KEY uq_user_date (userId, signDate)  -- ç”¨æˆ·IDå’Œç­¾åˆ°æ—¥æœŸçš„å”¯ä¸€æ€§çº¦æŸ
);

```

æŸ¥è¯¢ç”¨æˆ·çš„ç­¾åˆ°ä¿¡æ¯

```sql
SELECT signDate FROM user_sign_in 
WHERE userId = ? AND signDate BETWEEN ï¼ŸAND ?;
```

ä¼˜ç‚¹ï¼šåŸç†ç®€å•ï¼Œå®ç°å®¹æ˜“

ç¼ºç‚¹ï¼šéšç€ç”¨æˆ·çš„æ•°é‡å¢å¤§ï¼Œå¯¹æ•°æ®åº“çš„å‹åŠ›è¾ƒå¤§

**1.2.2 æ–¹æ¡ˆäºŒ-Redis Set**

redis key : `user:signins:{userid}`

redis value : `2024-09-28`

å¦‚ä¸‹å‘½ä»¤æ–°å¢é›†åˆ

```shell
SADD user:signins:123 "2024-09-01"
SADD user:signins:123 "2024-09-02"
```

æŸ¥æ‰¾è®°å½•

```shell
SMEMBERS user:signins:123
```

ä¼˜ç‚¹ï¼šsetç»“æ„å¤©ç„¶å»é‡ï¼ŒredisåŸºäºå†…å­˜é€Ÿåº¦å—ã€‚

ç¼ºç‚¹ï¼šä¸Šè¿°è®¾è®¡å­˜å‚¨äº†å¤§é‡çš„é‡å¤çš„å­—ç¬¦ä¸²å¦‚å¹´ä»½ï¼Œå¤ªæµªè´¹å†…å­˜äº†

å¦‚ä¸‹å­˜çš„æ•°æ®ï¼Œå¯ä»¥å°†å¹´ä»½æå–ä½œä¸ºkeyçš„éƒ¨åˆ†ï¼Œè¿™æ ·å­˜å‚¨çš„æ•°æ®å°±å‡å°‘äº†å¾ˆå¤š

```shell
key = user:signins:123
value = ["2024-09-01", "2024-09-02", "2024-10-01", "2024-10-02"]
```

**1.2.3æ–¹æ¡ˆä¸‰-Bitmapä½å›¾**

bitmapä½å›¾æ˜¯ä¸€ç§ä½¿ç”¨ï¼ˆbitï¼‰ä½æ¥è¡¨ç¤ºæ•°æ®çš„ç´§å‡‘æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä½èƒ½å­˜0æˆ–1ï¼Œç”¨æ¥è¡¨ç¤ºæŸç§çŠ¶æ€æˆ–æ ‡è¯†ï¼Œå› ä¸ºæ¯ä¸ºåªå ç”¨ä¸€bitä½ï¼ŒBitmapåœ¨å­˜å‚¨å¤§è§„æ¨¡äºŒå€¼æ•°æ®ï¼ˆå¦‚å¸ƒå°”ï¼‰éå¸¸é«˜æ•ˆä¸”èŠ‚çº¦ç©ºé—´ã€‚



ç”¨Bitmapæ¥åšç­¾åˆ°çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå­˜å‚¨ç”¨æˆ·åœ¨ä»Šå¹´çš„ç¬¬å‡ å¤©ç­¾åˆ°ï¼Œè€Œä¸æ˜¯å­˜ä¸€ä¸ªå®Œæ•´çš„æ—¥æœŸã€‚

```java
2024-01-01 => 1ï¼ˆç¬¬ä¸€å¤©ï¼‰
2024-01-03 => 3ï¼ˆç¬¬ä¸‰å¤©ï¼‰
```

ä½¿ç”¨Bitmapç±»å‹å­˜æ•°æ®ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªkeyï¼ŒBiyMapçš„æ¯ä¸€ä½æ¥è¡¨ç¤ºæŸä¸€å¤©æ˜¯å¦æ‰“å¡ã€‚

å¦‚ä¸‹ä¾‹ï¼š 0è¡¨ç¤ºæœªç­¾åˆ°ï¼Œ1è¡¨ç¤ºç­¾åˆ°

```java
0101 è¡¨ç¤ºç¬¬ 1 å¤©å’Œç¬¬ 3 å¤©å·²ç­¾åˆ°
1010 è¡¨ç¤ºç¬¬ 2 å¤©å’Œç¬¬ 4 å¤©å·²ç­¾åˆ°
```

é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨bitmapå‘¢ï¼Ÿ

JDKè‡ªå¸¦äº†BitSetç±»ï¼ŒRedisä¹Ÿæ”¯æŒbitmapæ•°æ®ç»“æ„ã€‚

RedisKeyçš„è®¾è®¡ï¼š`user:signins:{å¹´ä»½}ï¼š{userid}`

RedisValueçš„è®¾è®¡ï¼š`01010010100` bitmapç±»å‹çš„æ•°æ®ã€‚

ç”¨redisæ”¯æŒçš„bitmapæ“ä½œå¦‚ä¸‹

æ–°å¢

```shell
-- è¡¨ç¤ºç”¨æˆ·åœ¨ç¬¬ 240 å¤©æ‰“å¡
SETBIT user:signins:2024:123 240 1
-- è¡¨ç¤ºç”¨æˆ·åœ¨ç¬¬ 241 å¤©æ‰“å¡
SETBIT user:signins:2024:123 241 1

```

æŸ¥è¯¢

```shell
GETBIT user:signins:2024:123 240
```

åœ¨Javaç¨‹åºä¸­æä¾›äº†javaå®¢æˆ·å¸¦`Redission`

### 1.3 å¼€å‘æ¥å£

æ˜ç¡®å¼€å‘æ¥å£ï¼š åœ¨ç”¨æˆ·æ¯æ—¥é¦–æ¬¡æŸ¥è¯¢æŸä¸ªé¢˜ç›®è¯¦æƒ…çš„æ—¶å€™ï¼Œç­¾åˆ°ã€‚

#### 1.3.1å¼•å…¥Redission

1.å¼•å…¥ä¾èµ–

```xml
<dependency>
  <groupId>org.redisson</groupId>
  <artifactId>redisson</artifactId>
  <version>3.21.0</version>
</dependency>
```

2.é…ç½®rediså‚æ•°

```yaml
  # Redis é…ç½®
  # todo éœ€æ›¿æ¢é…ç½®ï¼Œç„¶åå–æ¶ˆæ³¨é‡Š
  redis:
    database: 1
    host: localhost
    port: 6379
    timeout: 5000
    password: 123456
```

3. åˆå§‹åŒ–redissionå®¢æœç«¯.åœ¨configåŒ…ä¸‹åˆ›å»º

```java
/**
 * redissoné…ç½®
 */
@Configuration
@ConfigurationProperties(prefix = "spring.redis")
@Data
public class RedissonConfig {


    private  String host;

    private Integer port;

    private Integer database;

    private String password;

    @Bean
    public RedissonClient redissonClient(){
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host +":"+ port)
                .setDatabase(database)
                .setPassword(password);


        return Redisson.create(config);
    }
}
```

å°è¯•å¯åŠ¨é¡¹ç›®çœ‹æ˜¯å¦æŠ¥é”™ã€‚

#### 1.3.2 æ·»åŠ åˆ·é¢˜ç­¾åˆ°æ¥å£

è§¦å‘æ—¶æœºï¼šå·²ç™»å½•ç”¨æˆ·æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…æ—¶ï¼Œè°ƒç”¨æ¥å£ï¼Œç­¾åˆ°ã€‚

ä¸šåŠ¡é€»è¾‘ï¼šå·²ç»ç™»å½•ç”¨æˆ·ï¼ŒæŸ¥çœ‹é¢˜ç›®è¯¦æƒ…ï¼Œåˆ¤æ–­ä»Šå¤©æ˜¯å¦å·²ç»ç­¾åˆ°ï¼Œæœªç­¾åˆ°å°±åœ¨bitmapæ–°å¢ï¼Œå·²ç­¾åˆ°å°±ä¸ç”¨å¤„ç†ã€‚

rediskey è®¾è®¡ï¼š`mainshidog:user:signins:{year}:{userid}` 

å› ä¸ºå¯¹rediè¯»å†™ éœ€è¦å¤šæ¬¡è¯»å†™ç›¸åŒçš„keyï¼Œæ‰€ä»¥å°†redis key çš„å®šä¹‰å•ç‹¬æ”¾åœ¨ä¸€èµ·å®šä¹‰å¸¸é‡.



1.åœ¨constantåŒ…ä¸‹åˆ›å»º

```java
public interface RedisConstant {

    /**
     * ç”¨æˆ·ç­¾åˆ°è®°å½•çš„ Redis Key å‰ç¼€
     */
    String USER_SIGN_IN_REDIS_KEY_PREFIX = "user:signins";

    /**
     * è·å–ç”¨æˆ·ç­¾åˆ°è®°å½•çš„ Redis Key
     * @param year å¹´ä»½
     * @param userId ç”¨æˆ· id
     * @return æ‹¼æ¥å¥½çš„ Redis Key
     */
    static String getUserSignInRedisKey(int year, long userId) {
        return String.format("%s:%s:%s", USER_SIGN_IN_REDIS_KEY_PREFIX, year, userId);
    }
}
```

2. UserServiceæ¥å£

   ```java
   /**
    * æ·»åŠ ç”¨æˆ·ç­¾åˆ°è®°å½•
    *
    * @param userId ç”¨æˆ· id
    * @return å½“å‰æ˜¯å¦å·²ç­¾åˆ°æˆåŠŸ
    */
   boolean addUserSignIn(long userId);
   
   ```

3. ç¼–å†™å®ç°ç±»

```java
    /**
     * æ·»åŠ ç”¨æˆ·ç­¾åˆ°è®°å½•
     *
     * @param userId ç”¨æˆ·ç­¾åˆ°
     * @return å½“å‰æ˜¯å¦å·²ç­¾åˆ°æˆåŠŸ
     */
    public boolean addUserSignIn(long userId) {
        // å½“å‰æ—¥æœŸ
        LocalDate localDate = LocalDate.now();
        int year = localDate.getYear();
        String key = RedisConstant.getUserSignInRedisKey(year, userId);

        //è·å–bitmap æ•°æ®
        RBitSet bitSet = redissonClient.getBitSet(key);
        //ä¸€å¹´çš„åç§»é‡  ä»ä¸€å¼€å§‹
        int dayOfYear = localDate.getDayOfYear();
        //æ˜¯å¦å·²ç»ç­¾åˆ°
        if (!bitSet.get(dayOfYear)){
            //æ²¡æœ‰ç­¾åˆ°
            bitSet.set(dayOfYear,true);
        }
        //å·²ç»ç­¾åˆ°
        return  true;
        
    }
```

4. ç¼–å†™controllerè¯·æ±‚

```java
    /**
     * æ–°å¢ç”¨æˆ·åˆ·é¢˜ç­¾åˆ°è®°å½•
     *
     * @param
     * @param request
     * @return
     */
    @PostMapping("/add/sign_in")
    public BaseResponse<Boolean> addUserSignIn(HttpServletRequest request) {
        //ç™»å½•çš„ç”¨æˆ·
        User loginUser = userService.getLoginUser(request);
        boolean result= userService.addUserSignIn(loginUser.getId());
        return ResultUtils.success(result);
    }
```

æ¥å£æµ‹è¯•

![image-20240929092710218](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929092710218.png)

#### 1.3.3æŸ¥è¯¢æŸ¥è¯¢ç­¾åˆ°æ¥å£

ä¸šåŠ¡é€»è¾‘ï¼š 1.é€šè¿‡useridå’Œå¹´ä»½æŸ¥è¯¢bitmapã€‚2.è·å–å¹´ä»½å¤©æ•°ï¼Œ3.æ‹¼æ¥æ—¥æœŸï¼Œæ ¹æ®æ—¥æœŸå»bitmapä¸­æŸ¥æ˜¯å¦ç­¾åˆ°ï¼Œå¹¶è®°å½•åœ¨æ•°ç»„ä¸­

4.å°†æ‹¼æ¥å¥½çš„ä¸€å¹´å†…çš„è®°å½•è¿”å›å‰ç«¯ã€‚

1. Userserviceæ¥å£

```java
  /**
     * è·å–ç­¾åˆ°è®°å½•
     * @param year
     * @param userid
     * @return  ä¸€æ•´å¹´ç­¾åˆ°è®°å½•çš„é›†åˆ  [[2024-09-28:true],[2024-09-29:false],[2024-09-30:false]]
     */
    Map<LocalDate,Boolean> getUserSignIn(Integer year,long userid);
```

2. å®ç°ç±»

```java
 /**
     * è·å–ç­¾åˆ°è®°å½•
     * @param year
     * @param userid
     * @return  ä¸€æ•´å¹´ç­¾åˆ°è®°å½•çš„é›†åˆ  [[2024-09-28:true],[2024-09-29:false],[2024-09-30:false]]
     */
    @Override
    public Map<LocalDate, Boolean> getUserSignIn(Integer year, long userid) {
        //ä¸ä¼ å¹´ä»½ï¼Œé»˜è®¤å½“å¹´

        if (year == null){
            LocalDate now = LocalDate.now();
            year = now.getYear();
        }
        //è·å–signInkey
        String userSignInRedisKey = RedisConstant.getUserSignInRedisKey(year, userid);
        //è·å–bitmapæ•°æ®
        RBitSet signbitSet = redissonClient.getBitSet(userSignInRedisKey);

        // æ„é€ è¿”å›ç»“æœ linkedHashMapä¿è¯æœ‰åº
        LinkedHashMap<LocalDate, Boolean> result = new LinkedHashMap<>();

        //è·å–å½“å‰å¹´æ€»å¤©æ•°
        int totalDays = Year.of(year).length();

        //ä¾æ¬¡è·å–æ¯ä¸€å¤©çš„ç­¾åˆ°çŠ¶æ€
        for (int dayOfYear = 1; dayOfYear <= totalDays; dayOfYear++) {
            // è·å–key ï¼š å½“å‰æ—¥æœŸ
           LocalDate currentDate = LocalDate.ofYearDay(year, dayOfYear);
            // è·å– value ï¼š å½“å‰æ˜¯å¦æœ‰åˆ·é¢˜
            boolean hasRecord = signbitSet.get(dayOfYear);
            result.put(currentDate,hasRecord);
        }

        return result;
    }
```

3. cotroller

```java
    /**
     * è·å–ç”¨æˆ·ç­¾åˆ°è®°å½•
     *
     * @param year    å¹´ä»½ï¼ˆä¸ºç©ºè¡¨ç¤ºå½“å‰å¹´ä»½ï¼‰
     * @param request
     * @return ç­¾åˆ°è®°å½•æ˜ å°„
     */
    @GetMapping("/get/sign_in")
    public BaseResponse<Map<LocalDate, Boolean>> getUserSignInRecord(Integer year, HttpServletRequest request) {
        // å¿…é¡»è¦ç™»å½•æ‰èƒ½è·å–
        User loginUser = userService.getLoginUser(request);
        Map<LocalDate, Boolean> userSignInRecord = userService.getUserSignIn(year,loginUser.getId());
        return ResultUtils.success(userSignInRecord);
    }
```

4.æ¥å£æµ‹è¯•

![image-20240929092934021](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929092934021.png)



### 1. 4æ€§èƒ½ä¼˜åŒ–

1. **åˆ¤æ–­æ¯å¤©æ˜¯å¦ç­¾åˆ°é€»è¾‘ä¼˜åŒ–**

ä¸‹è¿°ä»£ç ï¼Œå¾ªç¯å†…å¦‚éœ€è¦åˆ¤æ–­å½“å¤©æ˜¯å¦åˆ·é¢˜ï¼Œå®é™…ä¸Šæ¯æ¬¡åˆ¤æ–­éƒ½å»Redisäº¤äº’ï¼Œä¸€ä¸ªå¾ªç¯è¦äº¤äº’365æ¬¡redis.

```java
// ä¾æ¬¡è·å–æ¯ä¸€å¤©çš„ç­¾åˆ°çŠ¶æ€
for (int dayOfYear = 1; dayOfYear <= totalDays; dayOfYear++) {
    // è·å– keyï¼šå½“å‰æ—¥æœŸ
    LocalDate currentDate = LocalDate.ofYearDay(year, dayOfYear);
    // è·å– valueï¼šå½“å¤©æ˜¯å¦æœ‰åˆ·é¢˜
    boolean hasRecord = signInBitSet.get(dayOfYear);
    // å°†ç»“æœæ”¾å…¥ map
    result.put(currentDate, hasRecord);
}
```

`signinBitSet`æ˜¯é€šè¿‡Redissonå®¢æˆ·ç«¯ä¸Redisäº¤äº’`RBitSet`å¯¹è±¡ï¼Œè€Œ`RBitSet.get(int bitIndex)`è¿™ä¸ªæ–¹æ³•ä¼šè§¦å‘ä¾æ¬¡Rredisè¯·æ±‚æ¥è·å–å¯¹åº”çš„å€¼ï¼Œå¹¶æ²¡æœ‰å·¦æœ¬åœ°ç¼“å­˜ã€‚

è§£å†³æ–¹æ³•ï¼š æˆ‘ä»¬åœ¨å¾ªç¯å¤–ç¼“å­˜ä¸€ä¸‹BitMapæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨JDKè‡ªå¸¦çš„BitSetæ•°æ®ç»“æœåšæœ¬åœ°ç¼“å­˜ã€‚

```java
// åŠ è½½ BitSet åˆ°å†…å­˜ä¸­ï¼Œé¿å…åç»­è¯»å–æ—¶å‘é€å¤šæ¬¡è¯·æ±‚
BitSet bitSet = signInBitSet.asBitSet();
// è·å– valueï¼šå½“å¤©æ˜¯å¦æœ‰åˆ·é¢˜
boolean hasRecord = bitSet.get(dayOfYear);
```



2. **åˆ·é¢˜è®°å½•è¿”å›ç»“æœä¼˜åŒ–**

æˆ‘ä»¬åœ¨è¿”å›æ•°æ®æ—¶çš„æ•°æ®ç»“æ„ä¸ºï¼š

![image-20240929094702886](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929094702886.png)

ä¼ è¾“çš„æ•°æ®è¾ƒå¤šï¼Œè®¡ç®—æ—¶é—´è€—æ—¶ï¼Œå®½å¸¦å ç”¨å¤šï¼Œæ•ˆç‡ä½ã€‚

å®é™…ä¸Šæ²¡æœ‰å¿…è¦å®Œå…¨ç»„è£…å¥½æ•°æ®ä¼ è¾“ç»™å‰ç«¯ï¼Œä»…ä»…å‘Šè¯‰å‰ç«¯é‚£å¤©æœ‰åˆ·é¢˜å°±è¡Œï¼Œè¿™æ ·å¤§å¤§å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ä»¥åŠåç«¯cpuå ç”¨ï¼Œå°†éƒ¨åˆ†è®¡ç®—å‹åŠ›å‡æ‘Šåˆ°ç”¨æˆ·çš„å®¢æˆ·ç«¯ä¸Šï¼ˆæµè§ˆå™¨ï¼‰

è¿”å›çš„æ•°æ®ï¼š1 2 3 

ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š

```java
@Override
public List<Integer> getUserSignInRecord(long userId, Integer year) {
    if (year == null) {
        LocalDate date = LocalDate.now();
        year = date.getYear();
    }
    String key = RedisConstant.getUserSignInRedisKey(year, userId);
    RBitSet signInBitSet = redissonClient.getBitSet(key);
    // åŠ è½½ BitSet åˆ°å†…å­˜ä¸­ï¼Œé¿å…åç»­è¯»å–æ—¶å‘é€å¤šæ¬¡è¯·æ±‚
    BitSet bitSet = signInBitSet.asBitSet();
    // ç»Ÿè®¡ç­¾åˆ°çš„æ—¥æœŸ
    List<Integer> dayList = new ArrayList<>();
    // è·å–å½“å‰å¹´ä»½çš„æ€»å¤©æ•°
    int totalDays = Year.of(year).length();
    // ä¾æ¬¡è·å–æ¯ä¸€å¤©çš„ç­¾åˆ°çŠ¶æ€
    for (int dayOfYear = 1; dayOfYear <= totalDays; dayOfYear++) {
        // è·å– valueï¼šå½“å¤©æ˜¯å¦æœ‰åˆ·é¢˜
        boolean hasRecord = bitSet.get(dayOfYear);
        if (hasRecord) {
          dayList.add(dayOfYear);
        }
    }
    return dayList;
}

```

æ¥å£æµ‹è¯•

![image-20240929095737893](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929095737893.png)

3. **è®¡ç®—ä¼˜åŒ–**

BitSet æ˜¯ä¸€bitä½å­˜æ•°æ®çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œåªèƒ½å­˜01ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä½è¿ç®—ï¼Œä»£æ›¿ä½¿ç”¨ä¸Šè¿°forå¾ªç¯çš„æ£€æŸ¥é€»è¾‘ï¼Œè·³è¿‡æ— ç”¨çš„æ£€æŸ¥ã€‚

åœ¨Javaä¸­çš„`BitSet`ç±»ä¸­å¯ä»¥ä½¿ç”¨`nextSetBit(int fromIndex)`å’Œ`nextClearBit(int fromIndex)`æ–¹æ³•æ¥è·å–ä»æŒ‡å®šä¸‹æ ‡å¼€å§‹çš„ä¸‹ä¸€ä¸ªï¼ˆ1æˆ–0ï¼‰çš„ä½.

* `nextSetBit(int fromIndex)`:ä»`formindex`èµ·ï¼ˆåŒ…æ‹¬`fromindex`ï¼‰å¯»æ‰¾ä¸‹ä¸€ä¸ªä¸º1çš„ä½ï¼Œå¦‚æœæ‰¾åˆ°è¿”å›è¯¥ä½çš„ä¸‹æ ‡ï¼Œå¦‚æœæœªæ‰¾åˆ°è¿”å› -1.
* `nextClearBit(int fromIndex) `ï¼šä»`formindex`èµ·ï¼ˆåŒ…æ‹¬`fromindex`ï¼‰å¯»æ‰¾ä¸‹ä¸€ä¸ªä¸º0çš„ä½ï¼Œå¦‚æœæ‰¾åˆ°è¿”å›è¯¥ä½çš„ä¸‹æ ‡ï¼Œå¦‚æœæœªæ‰¾åˆ°è¿”å› å¤§çš„æ•´æ•°å€¼

ä¹‹æ‰€ä»¥èƒ½è·³è¿‡æ— ç”¨å¾ªç¯çš„åŸå› åœ¨äºï¼Œä»£ç å¦‚ä¸‹

```java
public int nextSetBit(int fromIndex) {
        if (fromIndex < 0)
            throw new IndexOutOfBoundsException("fromIndex < 0: " + fromIndex);

        checkInvariants();

        int u = wordIndex(fromIndex);
        if (u >= wordsInUse)
            return -1;

        long word = words[u] & (WORD_MASK << fromIndex);

        while (true) {
            if (word != 0)
                return (u * BITS_PER_WORD) + Long.numberOfTrailingZeros(word);
            if (++u == wordsInUse)
                return -1;
            word = words[u];
        }
    }
```

ä¸šåŠ¡ä»£ç ä¿®æ”¹å¦‚ä¸‹

```java
     //ä¾æ¬¡è·å–æ¯ä¸€å¤©çš„ç­¾åˆ°çŠ¶æ€ ä¼˜åŒ–ç‰ˆ
        int i = bitSet.nextSetBit(0);
        while (i >= 0){
            result.add(i);
           i =  bitSet.nextSetBit(i+1);
        }

```

**ä¼˜åŒ–å°ç»“**

1. å‡å°‘ç½‘è·¯è¯·æ±‚æˆ–è°ƒç”¨æ¬¡æ•°
2. å‡å°‘ä¼ è¾“æ•°æ®çš„ä½“ç§¯
3. å‡å°‘å¾ªç¯è®¡ç®—
4. é€šè¿‡å®¢æˆ·ç«¯å‡å°‘æœåŠ¡å™¨å‹åŠ›



## 2. åˆ†è¯çš„é¢˜ç›®æœç´¢

### 2.1éœ€æ±‚åˆ†æ

ç”±äºæˆ‘ä»¬ä½¿ç”¨sqlçš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œåœ¨è¿›è¡Œä¸‹è¿°æ“ä½œä¸­ï¼Œå¹¶ä¸èƒ½æœåˆ°é¢˜ç›®ï¼Œæ¨¡ç³ŠæŸ¥è¯¢ä¸çµæ´»ã€‚

![image-20240929162207007](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929162207007.png)

### 2.2 æ–¹æ¡ˆè®¾è®¡

ä½¿ç”¨Elasticsearchå®ç°é¢˜ç›®æ•°æ®çš„å­˜å‚¨å’Œåˆ†è¯æœç´¢ï¼Œéœ€è¦å°†æ•°æ®åº“çš„æ•°æ®åŒæ­¥åˆ°Elasticsearchä¸­ã€‚

[Documentation (elastic.co)](https://www.elastic.co/docs)







### 2.3å®‰è£…Elasticsearch

1.å®‰è£…ES

ç‰ˆæœ¬é€‰æ‹©7.17

å®‰è£…å‚è€ƒæ–‡æ¡£ï¼š[Set up Elasticsearch | Elasticsearch Guide [7.17\] | Elastic](https://www.elastic.co/guide/en/elasticsearch/reference/7.17/setup.html)

windows:[Install Elasticsearch with .zip on Windows | Elasticsearch Guide [7.17\] | Elastic](https://www.elastic.co/guide/en/elasticsearch/reference/7.17/zip-windows.html)

ä¸‹è½½è§£å‹åï¼šè¿›å…¥ESç›®å½•å¹¶æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼š

```shell
.\bin\elasticsearch.bat
```

æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸå‚è€ƒå®˜æ–¹æ–‡æ¡£

![image-20240929173737332](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929173737332.png)

```shell
curl -X GET "localhost:9200/?pretty"
```

![image-20240929173718509](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929173718509.png)



2. å®‰è£…Kibana  7.17

å‚è€ƒæ–‡æ¡£ï¼š[Kibanaâ€”your window into Elastic | Kibana Guide [7.17\] | Elastic](https://www.elastic.co/guide/en/kibana/7.17/introduction.html)

å®‰è£…ï¼š[Install Kibana | Kibana Guide [7.17\] | Elastic](https://www.elastic.co/guide/en/kibana/7.17/install.html)

å¯åŠ¨

```shell
.\bin\kibana.bat
```

é…ç½®

![image-20240929180640031](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929180640031.png)

æµ‹è¯•ï¼š 5601





åˆ†è¯å™¨æµ‹è¯•ï¼šlocalhost:5601

```json
POST /_analyze
{
  "analyzer": "standard", 
  "text": "æç¡•æ˜¯javaå·¥ç¨‹å¸ˆï¼Œè´Ÿè´£åç«¯æŠ€æœ¯é€‰å‹ä»¥åŠå¼€å‘å·¥ä½œ"
}

```

![image-20240929182524138](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929182524138.png)

ESé»˜è®¤æä¾›çš„åˆ†è¯å™¨

![image-20240929180929892](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929180929892.png)

ä½†æ˜¯è¿™äº›åˆ†è¯å™¨éƒ½ä¸æ”¯æŒä¸­æ–‡ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ikä¸­æ–‡åˆ†è¯å™¨ã€‚

3. å®‰è£…ikåˆ†è¯å™¨

å‚è€ƒæ–‡æ¡£ï¼š[infinilabs/analysis-ik: ğŸšŒ The IK Analysis plugin integrates Lucene IK analyzer into Elasticsearch and OpenSearch, support customized dictionary. (github.com)](https://github.com/infinilabs/analysis-ik)

ikåˆ†è¯å™¨ç‰ˆæœ¬è¦å’ŒESç‰ˆæœ¬ä¸€è‡´ï¼š[Index of: analysis-ik/stable/ (infinilabs.com)](https://release.infinilabs.com/analysis-ik/stable/)

å®‰è£…ï¼šè¿›å…¥esç›®å½•

```shell
.\bin\elasticsearch-plugin.bat install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-7.17.24.zip
```

![image-20240929183034276](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929183034276.png)

**ikåˆ†è¯å™¨æä¾›äº†ä¸¤ä¸ªåˆ†è¯å™¨ ï¼š `ik_smart`**å’Œ`ik_max_word`ã€‚

* ik_smart æ˜¯åªèƒ½åˆ†è¯ï¼Œå°½é‡é€‰æ‹©æœ€æƒ³ä¸€ä¸ªè¯çš„æ‹†åˆ†æ–¹å¼æ¯”å¦‚â€œå¥½å­¦ç”Ÿè¢«è¯†åˆ«ä¸ºä¸€ä¸ªè¯â€
* ik_max_word å°½å¯èƒ½ çš„åˆ†è¯ï¼ŒåŒ…æ‹¬ç»„åˆè¯æ¯”å¦‚ï¼šâ€œå¥½å­¦ç”Ÿâ€ è¢«è¯†åˆ«ä¸‰ä¸ªè¯ï¼šå¥½å­¦ç”Ÿï¼Œå¥½å­¦ï¼Œå­¦ç”Ÿ

æµ‹è¯•ï¼š

```json
POST /_analyze
{
  "analyzer": "ik_smart", 
  "text": "æç¡•æ˜¯javaå·¥ç¨‹å¸ˆï¼Œè´Ÿè´£åç«¯æŠ€æœ¯é€‰å‹ä»¥åŠå¼€å‘å·¥ä½œ"
}

```

![image-20240929183730251](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929183730251.png)

![image-20240929201623323](images/å¼€å‘æ‰‹å†Œ.assets/image-20240929201623323.png)

ä¸¤ä¸ªåˆ†è¯å™¨çš„é€‰ç”¨ä½¿ç”¨ï¼š

* `ik_smart`:**é€‚ç”¨äºæœç´¢åˆ†è¯**ï¼Œåœ¨æŸ¥è¯¢ä½¿ç”¨ï¼Œä¿è¯æ€§èƒ½çš„åŒæ—¶æä¾›åˆç†çš„åˆ†è¯ç²¾åº¦
* `ik_max_word`ï¼š**é€‚ç”¨äºåº•å±‚ç´¢å¼•åˆ†è¯**ï¼Œç¡®ä¿åœ¨å»ºç«‹ç´¢å¼•æ—¶å°½å¯èƒ½çš„å¤šåˆ†è¯ï¼Œæé«˜æŸ¥è¯¢æ—¶çš„åŒ¹é…åº¦å’Œè¦†ç›–é¢ã€‚

tips:**IKåˆ†è¯å™¨è¯†åˆ«è¯æ±‡ä¸å‡†ç¡®ï¼Œå°±å¦‚ä¸Šè¿°ä¸è®¤è¯†â€œæç¡•â€ï¼Œé‚£ä¹ˆæ€ä¹ˆè®©ikæŒ‰ç…§è‡ªå·±çš„è§„åˆ™åˆ†è¯ï¼Ÿ**

å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰è¯å…¸ï¼š[infinilabs/analysis-ik at v7.17.18 (github.com)](https://github.com/infinilabs/analysis-ik/tree/v7.17.18?tab=readme-ov-file#dictionary-configuration)



### 2.4 åˆ›å»ºESåº“

```json
PUT /question_v1
{
  "aliases": {
    "question": {}
  },
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "fields": {
          "keyword": {
            "type": "keyword",
            "ignore_above": 256
          }
        }
      },
      "content": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      },
      "tags": {
        "type": "keyword"
      },
      "answer": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      },
      "userId": {
        "type": "long"
      },
      "editTime": {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss"
      },
      "createTime": {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss"
      },
      "updateTime": {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss"
      },
      "isDelete": {
        "type": "keyword"
      }
    }
  }
}
```

### 2.5 åˆ›å»ºESå®¢æˆ·ç«¯

1. å¼•å…¥ä¾èµ–

```xml
<!-- elasticsearch-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-elasticsearch</artifactId>
</dependency>
```

2. yamlé…ç½®

```yaml
spring:
  elasticsearch:
    uris: http://xxx:9200
    username: elastic
    password: admin
```



3. ä½¿ç”¨

SpringDateEs Template

æˆ–è€…ç»§æ‰¿



### 2.6å¼€å‘

ESDTO

```java

@Document(indexName = "question")
@Data
public class QuestionEsDTO implements Serializable {
    private static final String DATE_TIME_PATTERN = "yyyy-MM-dd HH:mm:ss";
    /**
     * id
     */
    @Id
    private Long id;
    /**
     * æ ‡é¢˜
     */
    private String title;
    /**
     * å†…å®¹
     */
    private String content;
    /**
     * ç­”æ¡ˆ
     */
    private String answer;
    /**
     * æ ‡ç­¾åˆ—è¡¨
     */
    private List<String> tags;
    /**
     * åˆ›å»ºç”¨æˆ· id
     */
    private Long userId;
    /**
     * åˆ›å»ºæ—¶é—´
     */
    @Field(type = FieldType.Date, format = {}, pattern = DATE_TIME_PATTERN)
    private Date createTime;
    /**
     * æ›´æ–°æ—¶é—´
     */
    @Field(type = FieldType.Date, format = {}, pattern = DATE_TIME_PATTERN)
    private Date updateTime;
    /**
     * æ˜¯å¦åˆ é™¤
     */
    private Integer isDelete;
    private static final long serialVersionUID = 1L;
    /**
     * å¯¹è±¡è½¬åŒ…è£…ç±»
     *
     * @param question
     * @return
     */
    public static QuestionEsDTO objToDto(Question question) {
        if (question == null) {
            return null;
        }
        QuestionEsDTO questionEsDTO = new QuestionEsDTO();
        BeanUtils.copyProperties(question, questionEsDTO);
        String tagsStr = question.getTags();
        if (StrUtil.isNotBlank(tagsStr)) {
            questionEsDTO.setTags(JSONUtil.toList(tagsStr, String.class));
        }
        return questionEsDTO;
    }
    /**
     * åŒ…è£…ç±»è½¬å¯¹è±¡
     *
     * @param questionEsDTO
     * @return
     */
    public static Question dtoToObj(QuestionEsDTO questionEsDTO) {
        if (questionEsDTO == null) {
            return null;
        }
        Question question = new Question();
        BeanUtils.copyProperties(questionEsDTO, question);
        List<String> tagList = questionEsDTO.getTags();
        if (CollUtil.isNotEmpty(tagList)) {
            question.setTags(JSONUtil.toJsonStr(tagList));
        }
        return question;
    }
}
```

DAO

```java
/**
 * é¢˜ç›® ES æ“ä½œ

 */
public interface QuestionEsDao extends ElasticsearchRepository<QuestionEsDTO, Long> {


//    List<QuestionEsDao> findByUserId(Long userId);
}
```

å…¨é‡åŒæ­¥åˆ°ES

```java
import cn.hutool.core.collection.CollUtil;
import com.ls.mianshidog.esdao.QuestionEsDao;
import com.ls.mianshidog.model.dto.question.QuestionEsDTO;
import com.ls.mianshidog.model.entity.Question;
import com.ls.mianshidog.model.entity.User;
import com.ls.mianshidog.service.QuestionService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;
import javax.annotation.Resource;
import java.util.List;
import java.util.stream.Collectors;
/**
 * å…¨é‡åŒæ­¥é¢˜ç›®åˆ° es

 */
// todo å–æ¶ˆæ³¨é‡Šå¼€å¯ä»»åŠ¡
@Component
@Slf4j
public class FullSyncQuestionToEs implements CommandLineRunner {
    @Resource
    private QuestionService questionService;
    @Resource
    private QuestionEsDao questionEsDao;
    @Override
    public void run(String... args) {
        // å…¨é‡è·å–é¢˜ç›®ï¼ˆæ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼‰
        List<Question> questionList = questionService.list();
        if (CollUtil.isEmpty(questionList)) {
            return;
        }
        // è½¬ä¸º ES å®ä½“ç±»
        List<QuestionEsDTO> questionEsDTOList = questionList.stream()
                .map(QuestionEsDTO::objToDto)
                .collect(Collectors.toList());
        // åˆ†é¡µæ‰¹é‡æ’å…¥åˆ° ES
        final int pageSize = 500;
        int total = questionEsDTOList.size();
        log.info("FullSyncQuestionToEs start, total {}", total);
        for (int i = 0; i < total; i += pageSize) {
            // æ³¨æ„åŒæ­¥çš„æ•°æ®ä¸‹æ ‡ä¸èƒ½è¶…è¿‡æ€»æ•°æ®é‡
            int end = Math.min(i + pageSize, total);
            log.info("sync from {} to {}", i, end);
            User user = new User();

            questionEsDao.saveAll(questionEsDTOList.subList(i,end));
//            questionEsDao.saveAll(questionEsDTOList.subList(i, end));
        }
        log.info("FullSyncQuestionToEs end, total {}", total);
    }
}


```

æµ‹è¯•  å¼€å§‹æ³¨é‡Šï¼Œå¯åŠ¨é¡¹ç›®ï¼ŒæŸ¥è¯¢ESæ•°æ®

![image-20241001091946759](images/å¼€å‘æ‰‹å†Œ.assets/image-20241001091946759.png)



å¢é‡åŒæ­¥

```java
/**
 * å¢é‡åŒæ­¥å¸–å­åˆ° es

 */
// todo å–æ¶ˆæ³¨é‡Šå¼€å¯ä»»åŠ¡
@Component
@Slf4j
public class IncSyncQuestionToEs {
    @Resource
    private QuestionMapper questionMapper;
    @Resource
    private QuestionEsDao questionEsDao;
    /**
     * æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
     */
    @Scheduled(fixedRate = 60 * 1000)
    public void run() {
        // æŸ¥è¯¢è¿‘ 5 åˆ†é’Ÿå†…çš„æ•°æ®
        long FIVE_MINUTES = 5 * 60 * 1000L;
        Date fiveMinutesAgoDate = new Date(new Date().getTime() - FIVE_MINUTES);
        List<Question> questionList = questionMapper.listQuestionWithDelete(fiveMinutesAgoDate);
        if (CollUtil.isEmpty(questionList)) {
            log.info("no inc question");
            return;
        }
        List<QuestionEsDTO> questionEsDTOList = questionList.stream()
                .map(QuestionEsDTO::objToDto)
                .collect(Collectors.toList());
        final int pageSize = 500;
        int total = questionEsDTOList.size();
        log.info("IncSyncQuestionToEs start, total {}", total);
        for (int i = 0; i < total; i += pageSize) {
            int end = Math.min(i + pageSize, total);
            log.info("sync from {} to {}", i, end);
            questionEsDao.saveAll(questionEsDTOList.subList(i, end));
        }
        log.info("IncSyncQuestionToEs end, total {}", total);
    }
}
```

å®ç°æ–¹æ³•   `questionMapper.listQuestionWithDelete(fiveMinutesAgoDate);`

```java
public interface QuestionMapper extends BaseMapper<Question> {

    @Select("select * from question where updateTime >= #{minUpdateTime}")
    List<Question> listQuestionWithDelete(Date fiveMinutesAgoDate);
}
```



æµ‹è¯• ä¿®æ”¹æ•°æ®åº“

![image-20241001092117661](images/å¼€å‘æ‰‹å†Œ.assets/image-20241001092117661.png)

ES  æœç´¢

questionService

```java
/**
 * ä» ES æŸ¥è¯¢é¢˜ç›®
 *
 * @param questionQueryRequest
 * @return
 */
Page<Question> searchFromEs(QuestionQueryRequest questionQueryRequest);

```

å®ç°

```java
 /**
     * ä» ES æŸ¥è¯¢é¢˜ç›®
     *
     * @param questionQueryRequest
     * @return
     */
    @Override
    public Page<Question> searchFromEs(QuestionQueryRequest questionQueryRequest) {
        // è·å–å‚æ•°
        Long id = questionQueryRequest.getId();
        Long notId = questionQueryRequest.getNotId();
        String searchText = questionQueryRequest.getSearchText();
        List<String> tags = questionQueryRequest.getTags();
        Long questionBankId = questionQueryRequest.getQuestionBankId();
        Long userId = questionQueryRequest.getUserId();


        // æ³¨æ„ï¼ŒES çš„èµ·å§‹é¡µä¸º 0
        int current = questionQueryRequest.getCurrent() - 1;
        int pageSize = questionQueryRequest.getPageSize();
        String sortField = questionQueryRequest.getSortField();
        String sortOrder = questionQueryRequest.getSortOrder();

        // æ„é€ æŸ¥è¯¢æ¡ä»¶
        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();
        // è¿‡æ»¤
        boolQueryBuilder.filter(QueryBuilders.termQuery("isDelete", 0));
        if (id != null) {
            boolQueryBuilder.filter(QueryBuilders.termQuery("id", id));
        }
        if (notId != null) {
            boolQueryBuilder.mustNot(QueryBuilders.termQuery("id", notId));
        }
        if (userId != null) {
            boolQueryBuilder.filter(QueryBuilders.termQuery("userId", userId));
        }
        if (questionBankId != null) {
            boolQueryBuilder.filter(QueryBuilders.termQuery("questionBankId", questionBankId));
        }
        // å¿…é¡»åŒ…å«æ‰€æœ‰æ ‡ç­¾
        if (CollUtil.isNotEmpty(tags)) {
            for (String tag : tags) {
                boolQueryBuilder.filter(QueryBuilders.termQuery("tags", tag));
            }
        }
        // æŒ‰å…³é”®è¯æ£€ç´¢
        if (StringUtils.isNotBlank(searchText)) {
            boolQueryBuilder.should(QueryBuilders.matchQuery("title", searchText));
            boolQueryBuilder.should(QueryBuilders.matchQuery("content", searchText));
            boolQueryBuilder.should(QueryBuilders.matchQuery("answer", searchText));
            boolQueryBuilder.minimumShouldMatch(1);
        }
        // æ’åº
        SortBuilder<?> sortBuilder = SortBuilders.scoreSort();
        if (StringUtils.isNotBlank(sortField)) {
            sortBuilder = SortBuilders.fieldSort(sortField);
            sortBuilder.order(CommonConstant.SORT_ORDER_ASC.equals(sortOrder) ? SortOrder.ASC : SortOrder.DESC);
        }
        // åˆ†é¡µ
        PageRequest pageRequest = PageRequest.of(current, pageSize);
        // æ„é€ æŸ¥è¯¢
        NativeSearchQuery searchQuery = new NativeSearchQueryBuilder()
                .withQuery(boolQueryBuilder)
                .withPageable(pageRequest)
                .withSorts(sortBuilder)
                .build();
        SearchHits<QuestionEsDTO> searchHits = elasticsearchRestTemplate.search(searchQuery, QuestionEsDTO.class);
        // å¤ç”¨ MySQL çš„åˆ†é¡µå¯¹è±¡ï¼Œå°è£…è¿”å›ç»“æœ
        Page<Question> page = new Page<>();
        page.setTotal(searchHits.getTotalHits());
        List<Question> resourceList = new ArrayList<>();
        if (searchHits.hasSearchHits()) {
            List<SearchHit<QuestionEsDTO>> searchHitList = searchHits.getSearchHits();
            for (SearchHit<QuestionEsDTO> questionEsDTOSearchHit : searchHitList) {
                resourceList.add(QuestionEsDTO.dtoToObj(questionEsDTOSearchHit.getContent()));
            }
        }
        page.setRecords(resourceList);
        return page;
    }
```



ç¼–å†™æ¥å£

```java
@PostMapping("/search/page/vo")
public BaseResponse<Page<QuestionVO>> searchQuestionVOByPage(@RequestBody QuestionQueryRequest questionQueryRequest,
                                                     HttpServletRequest request) {
    long size = questionQueryRequest.getPageSize();
    // é™åˆ¶çˆ¬è™«
    ThrowUtils.throwIf(size > 200, ErrorCode.PARAMS_ERROR);
    Page<Question> questionPage = questionService.searchFromEs(questionQueryRequest);
    return ResultUtils.success(questionService.getQuestionVOPage(questionPage, request));
}

```

æµ‹è¯•

ä¹‹å‰çš„æœç´¢

![image-20241001095843684](images/å¼€å‘æ‰‹å†Œ.assets/image-20241001095843684.png)

ç°åœ¨çš„æœç´¢

![image-20241001100652154](images/å¼€å‘æ‰‹å†Œ.assets/image-20241001100652154.png)